# 1. 概念（Claude Code の全体像）

## 1.1 Claude Code は何か
Claude Code は「CLI 上で動くコーディング支援エージェント」です。
単なるチャットではなく、**ファイル操作・コマンド実行・変更提案**まで含めて作業の主体になります。
ただし、勝手に動くわけではなく、**指示・コンテキスト・権限**が揃った範囲でしか動きません。

## 1.2 重要な4レイヤー
Claude Code を理解するために、次の 4 レイヤーを分けると混乱しにくいです。

1) **目的（Goal）**
- 何を達成したいか（例: 「API を追加する」）

2) **コンテキスト（Context）**
- どの情報を与えるか（設計 docs、既存コード、制約）

3) **ツール（Tools）**
- 何が実行できるか（ファイル読み込み、コマンド、MCP）

4) **権限（Permissions）**
- どこまで許可されているか（サンドボックス、書き込み制限）

この 4 つの組み合わせが作業結果を決めます。

## 1.3 「拡張機能」の位置づけ
Claude Code の拡張機能は、**目的とコンテキストを安定させる装置**です。

- **CLAUDE.md / .claude/rules**: ルールと前提を常に読み込む
- **Skills**: 作業手順を型として保存する
- **Sub-agents**: 役割分担（調査/実装/レビューなど）
- **Hooks**: ライフサイクルイベントで自動処理
- **MCP**: 外部ツールやデータベースと連携

「拡張機能を使う = プロンプトを減らして再現性を上げる」と考えるとよいです。

## 1.4 タスクの種類と適性
Claude Code に向くタスク / 向かないタスクを分けて考えます。

**向く**
- 仕様が明確で、変更範囲が限定されている
- 反復的な作業（同じ手順が多い）
- 設計→実装→検証の流れが明確

**向かない**
- 仕様が曖昧で、利害関係者調整が必要
- 安全性や規制が強く、慎重な承認フローが必要
- 大規模リファクタで影響範囲が読めない

## 1.5 リスク・影響度マトリクス
作業に入る前に、**影響範囲とリスク**を先に見ると安全です。

```
影響大 × リスク大  → まず設計・レビューを固める
影響大 × リスク小  → 先に計画、段階実装
影響小 × リスク大  → 小さく試して確認
影響小 × リスク小  → そのまま実装
```

## 1.6 思考モデル（シニア向けの視点）
- Claude Code は **「動的に変化するコンテキストを持つ実行環境」** と捉える
- 失敗の多くは「コンテキストの不足」か「コンテキストの過剰」
- ルールや手順は **“最低限” で十分**。過度なルールは逆効果
- チーム運用では「更新と合意のコスト」を強く意識する

## 1.7 ミニケース
### ケース: 変更範囲が広すぎて失敗
- 目的: 「検索機能を改善したい」
- 失敗: 仕様が曖昧なまま複数ファイルを改変し、レビューが詰まる
- 改善: 「検索結果の並び順だけを変更」にスコープを絞る

## 1.7.1 良い例 / 悪い例（目的の定義）

| 観点 | 悪い例 | 良い例 |
| --- | --- | --- |
| 目的 | 検索を良くする | 検索結果の並び順を created_at 降順に統一する |

## 1.7.2 まとめ
- 良い例は「何を」「どこまで」やるかが 1 文でわかる

## 1.8 練習
- いまのタスクを「目的 / コンテキスト / ツール / 権限」に分解する
- どのレイヤーが不足しそうかを 1 つ挙げる

### 演習テンプレ
目的: 4 レイヤーでタスクを分解する
入力: いまのタスク 1 件
出力:
```
目的:
コンテキスト（正本/対象）:
ツール（使う/使わない）:
権限（必要/不要）:
不足しそうな情報:
```

### 解答例
```
目的: 検索結果の並び順を created_at 降順にする
コンテキスト（正本/対象）: docs/requirements.md, app/api/search.py
ツール（使う/使わない）: ファイル読み取り/書き込みは使う、Web検索は使わない
権限（必要/不要）: src 配下の編集権限が必要
不足しそうな情報: 既存の並び順ルール（仕様の該当箇所）
```

## 1.9 チェックリスト
- 目的が 1 文で説明できる
- 参照すべき正本ドキュメントが特定できる
- 実行してよいツールや権限が把握できている

## 参考
- https://docs.claude.com/en/docs/claude-code/overview
- https://docs.claude.com/en/docs/claude-code/settings
- https://www.humanlayer.dev/blog/writing-a-good-claude-md
- https://zenn.dev/tmasuyama1114/articles/claude_code_extension_guide
