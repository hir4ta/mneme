# 5. 応用（実務でどう使う）

## 5.1 典型ワークフロー
1. **調査**: 仕様・設計 doc と対象コードを読ませる（`@` 参照を活用）
2. **計画**: 変更方針と差分の範囲を提案させる（Plan Mode も有効）
3. **実装**: 小さな差分で進める
4. **検証**: テスト・ビルド・lint
5. **振り返り**: ルールや doc に反映

## 5.2 役割別の使い方
- **ジュニア**: 目的・制約・完了条件に集中し、変更範囲を狭くする
- **ミドル**: 仕様との整合性、影響範囲の漏れを確認する
- **シニア**: ルールの設計、チームの運用フローを整える

## 5.3 ジュニア向けの実践Tips
- 章 2 のテンプレを使って依頼を書く
- 変更範囲を狭くして「小さな成功」を積み上げる
- わからないことは質問させる

## 5.4 シニア向けの実践Tips
- ルールを薄く保ち、ドキュメントで管理する
- チームで「更新のルール」を決める
- Sub-agent を使う時は役割境界を明確にする
- **規模が大きい変更ほど、Plan を先に作る**
- 実装前に「想定される影響」を列挙させる

## 5.5 チーム運用のポイント
- CLAUDE.md は PR で更新し、チーム合意を取る
- `.claude/rules` の階層設計でコンテキスト肥大を防ぐ
- 重要な決定は「正本」に戻す

## 5.5.1 チーム運用フロー（標準）
1. **課題の明確化**: 目的・制約・完了条件を1枚で整理
2. **正本の特定**: requirements/design の正本を指定
3. **計画の合意**: 変更方針と影響範囲をレビュー
4. **実装**: 小さく分割して進める
5. **検証**: lint/build/test
6. **振り返り**: ルールやドキュメントに反映

## 5.5.2 役割分担の基本
- **依頼者**: 目的・制約・完了条件を明記
- **実装者**: 影響範囲を説明し、計画を提示
- **レビュアー**: 仕様整合性とリスクを優先確認

## 5.5.3 CLAUDE.md 運用ルール（推奨）
- 変更は必ず PR でレビュー
- ルールは「短く・具体的に」
- 例と非目標（やらないこと）を併記

## 5.5.4 レビュー基準（実装系）
- **仕様整合**: 正本の仕様に一致しているか
- **影響範囲**: 変更範囲が妥当か
- **安全性**: 破壊的変更が混ざっていないか
- **テスト**: 追加・修正すべきテストがあるか
- **読みやすさ**: 意図がコードから読み取れるか

## 5.6 ケース別の使い方

### 5.6.1 バグ修正
- 目的: 再現と原因の特定
- コンテキスト: バグ報告、該当ログ、再現手順
- 完了条件: 再現テストの追加 or 既存テストで再現

### 5.6.2 新機能追加
- 目的: 要件の整理と設計
- コンテキスト: 要件 doc、UI/UX ガイド
- 完了条件: 仕様に沿った実装と検証

### 5.6.3 リファクタ
- 目的: 可読性向上、負債削減
- コンテキスト: 既存コード、規約
- 完了条件: 振る舞いは変えずに差分が小さい

## 5.7 よくある失敗と回避策
- **指示が曖昧**: 目的・制約・完了条件を追加
- **変更範囲が大きすぎる**: 機能単位で分割
- **古い情報の混入**: 正本ドキュメントのみ渡す
- **検証不足**: lint/build/test を必ず実行

## 5.8 例（実務の依頼文）

| 観点 | 悪い例 | 良い例 |
| --- | --- | --- |
| 目的 | ログイン画面を良い感じに直しておいて | ログイン画面のエラーメッセージを統一したい |
| 制約 | 指定なし | 変更範囲は `app/ui/login/` のみ |
| 完了条件 | 指定なし | 文言一覧が 1 つにまとまり、既存テストが通る |
| 参照 | なし | docs/ui-guidelines.md |

## 5.9 反復改善の流れ
1. 出力に満足できない点を 1 つ特定
2. その点を制約や評価条件に追加
3. 再実行して差分を見る

## 5.10 レビュー観点（簡易）
- 仕様との整合性は保たれているか
- 影響範囲は限定されているか
- 変更が読みやすく、コメントが不足していないか
- テストは適切に追加されているか

## 5.10.1 レビュー観点（プロンプト系）
- 目的・制約・完了条件が明記されているか
- 非目標が定義されているか
- 参照すべき正本が指定されているか
- 出力形式やテスト条件が書かれているか

## 5.10.2 レビュー観点（詳細・実装）
- **リスク評価**: 変更により壊れる可能性の高い領域は特定できているか
- **セキュリティ**: 認証・認可・データ漏洩の懸念はないか
- **互換性**: 既存 API / 仕様との互換性を壊していないか
- **性能**: クリティカルパスの性能劣化が起きていないか
- **回帰**: 同種のバグが再発しないようテストがあるか
- **運用**: 監視・ログ・アラートの観点が抜けていないか

## 5.10.3 レビュー観点（詳細・プロンプト）
- **目的の明確さ**: 何を達成したいかが 1 文で言えるか
- **制約の妥当性**: 変更範囲と禁止事項が現実的か
- **検証の具体性**: テストや確認方法が実行可能か
- **失敗時の挙動**: 失敗した場合の扱いが決まっているか

## 5.11 練習
- 自分のタスクで「最小変更」にしたらどこまで絞れるかを書いてみる
- その後、必要な検証手順を 2 つ列挙する

### 演習テンプレ
目的: 実務依頼を最小粒度で書く
入力: いまのタスク 1 件
出力:
```
目的:
制約:
完了条件:
正本ドキュメント:
変更範囲:
検証手順:
- 
- 
```

### 解答例
```
目的: ログイン画面のエラーメッセージを統一する
制約: 変更範囲は app/ui/login/ のみ
完了条件: 文言が 1 つに集約され、既存テストが通る
正本ドキュメント: docs/ui-guidelines.md
変更範囲: app/ui/login/
検証手順:
- npm run lint
- npm run test
```

## 5.12 チェックリスト
- 変更範囲が 1 行で説明できる
- 検証方法が明確
- 仕様の正本が参照されている

## 参考
- https://code.claude.com/docs/en/best-practices
- https://docs.claude.com/en/docs/claude-code/common-workflows
- https://zenn.dev/akino/articles/62e25d7c1b37d6
